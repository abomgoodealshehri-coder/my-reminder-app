<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ù…Ø°ÙƒÙ‘Ø±ÙŠ">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoi2YXYsNmD2ZHYsduMIiwic2hvcnRfbmFtZSI6Itio2LDZg9ix2YrZhiIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMWExYTJlIiwidGhlbWVfY29sb3IiOiIjMDBkNGZmIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBSUFBQUFDQUNBWUFBQUQ1MkgvNUFBQUFFRWxFUVZSNDJ1M2FRUTZEUVJTRTBiL3YzK0hFQUFBQUVsRlRrU3VRbUNDIiwic2l6ZXMiOiIxMjh4MTI4IiwidHlwZSI6ImltYWdlL3BuZyJ9XX0=">
    <title>Ù…Ø°ÙƒÙ‘Ø±ÙŠ â°</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 15px;
            padding-bottom: 80px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 25px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .logo {
            font-size: 50px;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 28px;
            color: #00d4ff;
            margin-bottom: 5px;
            font-weight: 800;
        }

        .subtitle {
            color: #aaa;
            font-size: 14px;
        }

        .install-prompt {
            background: linear-gradient(135deg, #5f27cd 0%, #4a1fa8 100%);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            display: none;
            align-items: center;
            gap: 12px;
        }

        .install-prompt.show {
            display: flex;
        }

        .install-prompt-text {
            flex: 1;
            font-size: 14px;
            line-height: 1.4;
        }

        .install-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 10px 18px;
            border-radius: 10px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-start {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4);
        }

        .btn-stop {
            background: linear-gradient(135deg, #ff4757 0%, #cc3a47 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4);
        }

        .btn-add {
            background: linear-gradient(135deg, #5f27cd 0%, #4a1fa8 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(95, 39, 205, 0.4);
        }

        .add-form {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .add-form.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #aaa;
            font-size: 13px;
            font-weight: 600;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            font-family: 'Cairo', sans-serif;
            font-size: 15px;
        }

        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #00d4ff;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .form-group input[type="time"] {
            font-size: 18px;
            font-weight: 700;
        }

        .status-bar {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-item {
            text-align: center;
            flex: 1;
        }

        .status-label {
            font-size: 11px;
            color: #aaa;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 16px;
            font-weight: 700;
            color: #00d4ff;
        }

        .permission-warning {
            background: rgba(255, 193, 7, 0.15);
            border: 2px solid rgba(255, 193, 7, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            display: none;
        }

        .permission-warning.show {
            display: block;
        }

        .permission-warning-title {
            font-weight: 700;
            color: #ffc107;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .permission-warning-text {
            font-size: 13px;
            color: #ddd;
            line-height: 1.5;
        }

        .reminders-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .reminder-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 18px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        .reminder-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #00d4ff 0%, #5f27cd 100%);
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .reminder-card.active {
            border-color: #00d4ff;
            background: rgba(0, 212, 255, 0.1);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
            animation: pulse 2s infinite;
        }

        .reminder-card.active::before {
            transform: scaleX(1);
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
            }
            50% {
                box-shadow: 0 0 40px rgba(0, 212, 255, 0.5);
            }
        }

        .reminder-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .reminder-text {
            font-size: 18px;
            font-weight: 700;
            color: #fff;
            flex: 1;
            line-height: 1.4;
        }

        .delete-btn {
            background: rgba(255, 71, 87, 0.2);
            border: none;
            color: #ff4757;
            min-width: 35px;
            min-height: 35px;
            border-radius: 8px;
            font-size: 20px;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .delete-btn:hover {
            background: rgba(255, 71, 87, 0.3);
            transform: scale(1.1);
        }

        .delete-btn:active {
            transform: scale(0.95);
            background: rgba(255, 71, 87, 0.5);
        }

        .reminder-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .reminder-time {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 15px;
            color: #aaa;
        }

        .time-value {
            font-size: 20px;
            font-weight: 800;
            color: #00d4ff;
        }

        .countdown {
            background: rgba(95, 39, 205, 0.3);
            padding: 8px 14px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 700;
            color: #fff;
            border: 2px solid rgba(95, 39, 205, 0.5);
        }

        .countdown.soon {
            background: rgba(255, 193, 7, 0.3);
            border-color: rgba(255, 193, 7, 0.5);
            color: #ffc107;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .alert-box {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.7);
            transform: translateY(-200%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 1000;
        }

        .alert-box.show {
            transform: translateY(0);
        }

        .alert-title {
            font-size: 18px;
            font-weight: 800;
            margin-bottom: 10px;
            color: #fff;
        }

        .alert-message {
            font-size: 22px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .alert-time {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
        }

        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #aaa;
        }

        .empty-state-icon {
            font-size: 60px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(10px);
            padding: 12px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-around;
            z-index: 100;
        }

        .nav-item {
            text-align: center;
            color: #aaa;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-item.active {
            color: #00d4ff;
        }

        .nav-icon {
            font-size: 24px;
            margin-bottom: 3px;
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 24px;
            }
            
            .reminder-text {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">â°</div>
            <h1>Ù…Ø°ÙƒÙ‘Ø±ÙŠ Ø§Ù„Ø°ÙƒÙŠ</h1>
            <p class="subtitle">Ù„Ø§ ØªÙ†Ø³Ù‰ Ø£ÙŠ Ø´ÙŠØ¡ Ù…Ù‡Ù…</p>
        </div>

        <div class="install-prompt" id="installPrompt">
            <div style="font-size: 24px;">ğŸ“²</div>
            <div class="install-prompt-text">
                <strong>Ù†Ø²Ù‘Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</strong><br>
                Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ø¹Ø´Ø§Ù† ÙŠØ´ØªØºÙ„ Ø­ØªÙ‰ Ù„Ùˆ Ù‚ÙÙ„Øª Ø§Ù„Ø´Ø§Ø´Ø©
            </div>
            <button class="install-btn" onclick="showInstallInstructions()">ÙƒÙŠÙØŸ</button>
        </div>

        <div class="permission-warning" id="permissionWarning">
            <div class="permission-warning-title">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù‡Ù… Ù„Ù„Ø¬ÙˆØ§Ù„</div>
            <div class="permission-warning-text">
                â€¢ Ø¹Ù„Ù‰ <strong>Ø§Ù„Ø¢ÙŠÙÙˆÙ†</strong>: Ø§Ø¶ØºØ· Ø²Ø± "Ù…Ø´Ø§Ø±ÙƒØ©" <span style="font-size: 16px;">â‹</span> Ø«Ù… "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"<br>
                â€¢ Ø¹Ù„Ù‰ <strong>Ø§Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯</strong>: Ø§Ø¶ØºØ· Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© â‹® Ø«Ù… "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"<br>
                <br>
                <strong>ğŸŒ Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹:</strong> Ù„Ø§Ø²Ù… ØªØ³Ù…Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ø´Ø§Ù† ØªØ°ÙƒÙŠØ±Ø§Øª GPS ØªØ´ØªØºÙ„!<br>
                <strong>Ø¨Ø¹Ø¯ÙŠÙ† Ø§ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</strong> Ø¹Ø´Ø§Ù† ØªÙ‚Ø¯Ø± ØªØ³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª!
            </div>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <div class="status-label">Ø§Ù„Ø­Ø§Ù„Ø©</div>
                <div class="status-value" id="appStatus">Ù…ØªÙˆÙ‚Ù</div>
            </div>
            <div class="status-item">
                <div class="status-label">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¢Ù†</div>
                <div class="status-value" id="currentTime">--:--</div>
            </div>
            <div class="status-item">
                <div class="status-label">ğŸ“ GPS</div>
                <div class="status-value" id="gpsStatus" style="font-size: 13px;">ØºÙŠØ± Ù…ØªØ§Ø­</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-start" id="startBtn" onclick="toggleApp()">â–¶ï¸ ØªØ´ØºÙŠÙ„</button>
            <button class="btn btn-add" onclick="toggleForm()">â• Ø¥Ø¶Ø§ÙØ©</button>
        </div>

        <div class="add-form" id="addForm">
            <div class="form-group">
                <label>ğŸ¯ Ù†ÙˆØ¹ Ø§Ù„ØªØ°ÙƒÙŠØ±</label>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button class="type-btn active" id="timeTypeBtn" onclick="selectType('time')" style="flex: 1; padding: 12px; border: 2px solid #00d4ff; background: rgba(0, 212, 255, 0.2); color: #00d4ff; border-radius: 10px; font-weight: 700; cursor: pointer; font-family: 'Cairo', sans-serif;">
                        â° Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª
                    </button>
                    <button class="type-btn" id="locationTypeBtn" onclick="selectType('location')" style="flex: 1; padding: 12px; border: 2px solid rgba(255, 255, 255, 0.2); background: rgba(255, 255, 255, 0.05); color: #aaa; border-radius: 10px; font-weight: 700; cursor: pointer; font-family: 'Cairo', sans-serif;">
                        ğŸ“ Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹
                    </button>
                </div>
            </div>

            <div class="form-group" id="timeGroup">
                <label>â° Ø§Ù„ÙˆÙ‚Øª</label>
                <input type="time" id="timeInput">
            </div>

            <div class="form-group" id="locationGroup" style="display: none;">
                <label>ğŸ“ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª</label>
                <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                    <input type="number" step="any" id="latInput" placeholder="Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶ (Latitude)" style="flex: 1;">
                    <input type="number" step="any" id="lngInput" placeholder="Ø®Ø· Ø§Ù„Ø·ÙˆÙ„ (Longitude)" style="flex: 1;">
                </div>
                <button onclick="getCurrentLocation()" style="width: 100%; padding: 10px; background: rgba(95, 39, 205, 0.3); border: 2px solid rgba(95, 39, 205, 0.5); color: #fff; border-radius: 8px; font-weight: 600; cursor: pointer; font-family: 'Cairo', sans-serif; margin-bottom: 8px;">
                    ğŸ“ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ
                </button>
                <div style="font-size: 12px; color: #aaa; line-height: 1.4;">
                    ğŸ’¡ Ø£Ùˆ Ø§Ù†Ø³Ø® Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ù…Ù† Google Maps
                </div>
            </div>

            <div class="form-group">
                <label>ğŸ“ Ù†Øµ Ø§Ù„ØªØ°ÙƒÙŠØ±</label>
                <textarea id="textInput" placeholder="Ù…Ø«Ø§Ù„: Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡" required></textarea>
                <button onclick="testSpeech()" style="width: 100%; padding: 10px; margin-top: 8px; background: rgba(255, 193, 7, 0.3); border: 2px solid rgba(255, 193, 7, 0.5); color: #ffc107; border-radius: 8px; font-weight: 600; cursor: pointer; font-family: 'Cairo', sans-serif;">
                    ğŸ”Š Ø§Ø®ØªØ¨Ø± Ø§Ù„Ù†Ø·Ù‚
                </button>
            </div>

            <div class="form-group" id="locationNameGroup" style="display: none;">
                <label>ğŸ·ï¸ Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <input type="text" id="locationNameInput" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù…Ø³Ø¬Ø¯ØŒ Ø§Ù„Ø¨ÙŠØªØŒ Ø§Ù„Ø¹Ù…Ù„">
            </div>

            <button class="btn btn-start" style="width: 100%;" onclick="addReminder()">
                âœ… Ø­ÙØ¸ Ø§Ù„ØªØ°ÙƒÙŠØ±
            </button>
        </div>

        <div class="reminders-list" id="remindersList">
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ“­</div>
                <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°ÙƒÙŠØ±Ø§Øª Ø¨Ø¹Ø¯</p>
                <p style="font-size: 13px; margin-top: 5px;">Ø§Ø¶ØºØ· "â• Ø¥Ø¶Ø§ÙØ©" Ù„Ù„Ø¨Ø¯Ø¡</p>
            </div>
        </div>
    </div>

    <div class="alert-box" id="alertBox">
        <div class="alert-title" id="alertTitle">ğŸ”” ØªØ°ÙƒÙŠØ±</div>
        <div class="alert-message" id="alertMessage">---</div>
        <div class="alert-time" id="alertTime"></div>
    </div>

    <script>
        let reminders = [
            {
                text: "Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡",
                time: "06:55",
                type: "time",
                activated: false
            },
            {
                text: "Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±",
                time: "07:30",
                type: "time",
                activated: false
            }
        ];

        let isRunning = false;
        let checkInterval = null;
        let timeInterval = null;
        let countdownInterval = null;
        let notificationPermission = false;
        let currentUserLocation = null;
        let locationWatchId = null;
        let selectedType = 'time';

        // Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„ØªØ°ÙƒÙŠØ±
        function selectType(type) {
            selectedType = type;
            
            const timeBtn = document.getElementById('timeTypeBtn');
            const locationBtn = document.getElementById('locationTypeBtn');
            const timeGroup = document.getElementById('timeGroup');
            const locationGroup = document.getElementById('locationGroup');
            const locationNameGroup = document.getElementById('locationNameGroup');
            
            if (type === 'time') {
                timeBtn.style.background = 'rgba(0, 212, 255, 0.2)';
                timeBtn.style.borderColor = '#00d4ff';
                timeBtn.style.color = '#00d4ff';
                
                locationBtn.style.background = 'rgba(255, 255, 255, 0.05)';
                locationBtn.style.borderColor = 'rgba(255, 255, 255, 0.2)';
                locationBtn.style.color = '#aaa';
                
                timeGroup.style.display = 'block';
                locationGroup.style.display = 'none';
                locationNameGroup.style.display = 'none';
            } else {
                locationBtn.style.background = 'rgba(0, 212, 255, 0.2)';
                locationBtn.style.borderColor = '#00d4ff';
                locationBtn.style.color = '#00d4ff';
                
                timeBtn.style.background = 'rgba(255, 255, 255, 0.05)';
                timeBtn.style.borderColor = 'rgba(255, 255, 255, 0.2)';
                timeBtn.style.color = '#aaa';
                
                timeGroup.style.display = 'none';
                locationGroup.style.display = 'block';
                locationNameGroup.style.display = 'block';
            }
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
        function getCurrentLocation() {
            if (!navigator.geolocation) {
                alert('âš ï¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ø¬Ù‡Ø§Ø²Ùƒ!');
                return;
            }

            const btn = event.target;
            btn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...';
            btn.disabled = true;

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    document.getElementById('latInput').value = position.coords.latitude.toFixed(6);
                    document.getElementById('lngInput').value = position.coords.longitude.toFixed(6);
                    btn.textContent = 'âœ… ØªÙ…! Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ';
                    btn.disabled = false;
                    
                    setTimeout(() => {
                        btn.textContent = 'ğŸ“ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ';
                    }, 2000);
                },
                (error) => {
                    alert('âš ï¸ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹! ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹.');
                    btn.textContent = 'ğŸ“ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ';
                    btn.disabled = false;
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ù†Ù‚Ø·ØªÙŠÙ† (Ø¨Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Ù†ØµÙ Ù‚Ø·Ø± Ø§Ù„Ø£Ø±Ø¶ Ø¨Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹
        function startLocationTracking() {
            if (!navigator.geolocation) {
                console.log('Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…');
                document.getElementById('gpsStatus').textContent = 'âŒ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…';
                return;
            }

            document.getElementById('gpsStatus').textContent = 'â³ Ø¬Ø§Ø±ÙŠ...';

            locationWatchId = navigator.geolocation.watchPosition(
                (position) => {
                    currentUserLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    const accuracy = position.coords.accuracy.toFixed(0);
                    document.getElementById('gpsStatus').textContent = `âœ“ Ø¯Ù‚Ø© ${accuracy}Ù…`;
                    document.getElementById('gpsStatus').style.color = '#4ecca3';
                    
                    console.log('ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ:', currentUserLocation.lat.toFixed(6), currentUserLocation.lng.toFixed(6));
                    console.log('ğŸ¯ Ø¯Ù‚Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹:', accuracy, 'Ù…ØªØ±');
                },
                (error) => {
                    console.log('Ø®Ø·Ø£ ÙÙŠ ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹:', error.message);
                    
                    if (error.code === 1) {
                        document.getElementById('gpsStatus').textContent = 'âŒ Ù…Ø±ÙÙˆØ¶';
                        console.log('âŒ ØªÙ… Ø±ÙØ¶ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹');
                    } else if (error.code === 2) {
                        document.getElementById('gpsStatus').textContent = 'âš ï¸ ØºÙŠØ± Ù…ØªØ§Ø­';
                        console.log('âš ï¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªØ§Ø­');
                    } else if (error.code === 3) {
                        document.getElementById('gpsStatus').textContent = 'â° Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ù‡Ù„Ø©';
                        console.log('â° Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹');
                    }
                    
                    document.getElementById('gpsStatus').style.color = '#ff4757';
                },
                {
                    enableHighAccuracy: true,  // Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©
                    maximumAge: 5000,          // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ
                    timeout: 10000             // Ù…Ù‡Ù„Ø© 10 Ø«ÙˆØ§Ù†ÙŠ
                }
            );
        }

        // Ø¥ÙŠÙ‚Ø§Ù ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹
        function stopLocationTracking() {
            if (locationWatchId) {
                navigator.geolocation.clearWatch(locationWatchId);
                locationWatchId = null;
            }
        }

        // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        async function requestNotificationPermission() {
            if ('Notification' in window) {
                try {
                    const permission = await Notification.requestPermission();
                    notificationPermission = permission === 'granted';
                    
                    if (notificationPermission) {
                        document.getElementById('permissionWarning').classList.remove('show');
                    } else {
                        document.getElementById('permissionWarning').classList.add('show');
                    }
                    
                    return notificationPermission;
                } catch (e) {
                    console.log('Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©:', e);
                    return false;
                }
            }
            return false;
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù†Ø¸Ø§Ù…
        function sendSystemNotification(title, message) {
            if (notificationPermission && 'Notification' in window) {
                try {
                    const notification = new Notification(title, {
                        body: message,
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="75" font-size="75">â°</text></svg>',
                        badge: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="75" font-size="75">â°</text></svg>',
                        vibrate: [300, 100, 300],
                        requireInteraction: true,
                        tag: 'reminder-' + Date.now()
                    });

                    notification.onclick = () => {
                        window.focus();
                        notification.close();
                    };
                } catch (e) {
                    console.log('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:', e);
                }
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
        function updateCurrentTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            document.getElementById('currentTime').textContent = `${hours}:${minutes}`;
        }

        // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
        function getTimeRemaining(targetTime) {
            const now = new Date();
            const [hours, minutes] = targetTime.split(':');
            
            const target = new Date();
            target.setHours(parseInt(hours));
            target.setMinutes(parseInt(minutes));
            target.setSeconds(0);

            if (target < now) {
                target.setDate(target.getDate() + 1);
            }

            const diff = target - now;
            
            const h = Math.floor(diff / (1000 * 60 * 60));
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((diff % (1000 * 60)) / 1000);

            return { hours: h, minutes: m, seconds: s, total: diff };
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
        function updateCountdowns() {
            reminders.forEach((reminder, index) => {
                if (reminder.activated) return;

                const countdownEl = document.querySelector(`[data-index="${index}"] .countdown`);
                if (!countdownEl) return;

                // Ù„Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ù…Ø¨Ù†ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙ‚Øª
                if (reminder.type === 'time') {
                    const remaining = getTimeRemaining(reminder.time);
                    const h = remaining.hours;
                    const m = remaining.minutes;
                    const s = remaining.seconds;

                    let text = '';
                    if (h > 0) {
                        text = `${h}Ø³ ${m}Ø¯`;
                    } else if (m > 0) {
                        text = `${m}Ø¯ ${s}Ø«`;
                    } else {
                        text = `${s}Ø«`;
                    }

                    countdownEl.textContent = `â³ Ø¨Ø§Ù‚ÙŠ ${text}`;

                    if (h === 0 && m < 5) {
                        countdownEl.classList.add('soon');
                    } else {
                        countdownEl.classList.remove('soon');
                    }
                }

                // Ù„Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ù…Ø¨Ù†ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹
                if (reminder.type === 'location' && currentUserLocation && reminder.coords) {
                    const distance = calculateDistance(
                        currentUserLocation.lat,
                        currentUserLocation.lng,
                        reminder.coords.lat,
                        reminder.coords.lng
                    );

                    const distKm = distance.toFixed(2);
                    const distM = (distance * 1000).toFixed(0);

                    if (distance < 1) {
                        countdownEl.textContent = `ğŸ“ ${distM} Ù…ØªØ±`;
                    } else {
                        countdownEl.textContent = `ğŸ“ ${distKm} ÙƒÙ…`;
                    }

                    // Ù„ÙˆÙ† Ø£ØµÙØ± Ø¥Ø°Ø§ Ø£Ù‚Ù„ Ù…Ù† 100 Ù…ØªØ±
                    if (distance < 0.1) {
                        countdownEl.classList.add('soon');
                    } else {
                        countdownEl.classList.remove('soon');
                    }
                }
            });
        }

        // Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
        function showAlert(title, message) {
            const alertBox = document.getElementById('alertBox');
            const alertTitle = document.getElementById('alertTitle');
            const alertMessage = document.getElementById('alertMessage');
            const alertTime = document.getElementById('alertTime');
            
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
            
            alertTitle.textContent = title;
            alertMessage.textContent = message;
            alertTime.textContent = `â° ${timeStr}`;
            
            alertBox.classList.add('show');
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù†Ø¸Ø§Ù…
            sendSystemNotification(title, message);
            
            if (navigator.vibrate) {
                navigator.vibrate([300, 100, 300, 100, 300]);
            }
            
            // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø£ÙˆÙ„Ø§Ù‹
            playSound();
            
            // Ù†Ø·Ù‚ Ø§Ù„Ù†Øµ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ© Ù…Ù† Ø§Ù„ØµÙˆØª
            setTimeout(() => {
                speakText(message);
            }, 800);
            
            setTimeout(() => {
                alertBox.classList.remove('show');
            }, 6000);
        }

        // ØµÙˆØª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
        function playSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
                
                setTimeout(() => {
                    const osc2 = audioContext.createOscillator();
                    const gain2 = audioContext.createGain();
                    osc2.connect(gain2);
                    gain2.connect(audioContext.destination);
                    osc2.frequency.value = 1000;
                    osc2.type = 'sine';
                    gain2.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    osc2.start(audioContext.currentTime);
                    osc2.stop(audioContext.currentTime + 0.5);
                }, 200);
            } catch (e) {
                console.log('ØµÙˆØª ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…');
            }
        }

        // Ù†Ø·Ù‚ Ø§Ù„Ù†Øµ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ
        function speakText(text) {
            try {
                // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ù†Ø·Ù‚ Ø³Ø§Ø¨Ù‚
                window.speechSynthesis.cancel();

                // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø·Ù‚ Ø¬Ø¯ÙŠØ¯
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª Ø§Ù„Ø¹Ø±Ø¨ÙŠ
                utterance.lang = 'ar-SA'; // Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©
                utterance.rate = 0.9; // Ø³Ø±Ø¹Ø© Ø§Ù„Ù†Ø·Ù‚ (0.9 = Ø£Ø¨Ø·Ø£ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ÙˆØ¶ÙˆØ­ Ø£ÙƒØ«Ø±)
                utterance.pitch = 1; // Ø¯Ø±Ø¬Ø© Ø§Ù„ØµÙˆØª
                utterance.volume = 1; // Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª (1 = Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰)

                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙˆØª Ø¹Ø±Ø¨ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªÙˆÙØ±
                const voices = window.speechSynthesis.getVoices();
                const arabicVoice = voices.find(voice => 
                    voice.lang.startsWith('ar') || 
                    voice.lang.includes('AR') ||
                    voice.name.includes('Arabic') ||
                    voice.name.includes('ar-')
                );
                
                if (arabicVoice) {
                    utterance.voice = arabicVoice;
                    console.log('Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ø¹Ø±Ø¨ÙŠ:', arabicVoice.name);
                } else {
                    console.log('ØµÙˆØª Ø¹Ø±Ø¨ÙŠ ØºÙŠØ± Ù…ØªÙˆÙØ±ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ');
                }

                // Ù†Ø·Ù‚ Ø§Ù„Ù†Øµ
                window.speechSynthesis.speak(utterance);

                // Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª
                utterance.onend = () => {
                    console.log('Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ù†Ø·Ù‚');
                };

                utterance.onerror = (e) => {
                    console.log('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø·Ù‚:', e);
                };

            } catch (e) {
                console.log('Ø§Ù„Ù†Ø·Ù‚ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­:', e);
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø·Ù‚
        function testSpeech() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ø£ÙˆÙ„Ø§Ù‹!');
                return;
            }

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø£ÙˆÙ„Ø§Ù‹ (Ù…Ù‡Ù… Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø©)
            if (window.speechSynthesis.getVoices().length === 0) {
                window.speechSynthesis.addEventListener('voiceschanged', () => {
                    speakText(text);
                }, { once: true });
            } else {
                speakText(text);
            }
        }

        // ÙØ­Øµ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª
        function checkReminders() {
            const now = new Date();
            const currentTime = now.getHours().toString().padStart(2, '0') + ':' + 
                              now.getMinutes().toString().padStart(2, '0');

            reminders.forEach((reminder) => {
                if (reminder.activated) return;

                // ÙØ­Øµ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ù…Ø¨Ù†ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙ‚Øª
                if (reminder.type === 'time' && currentTime === reminder.time) {
                    showAlert("ğŸ”” ØªØ°ÙƒÙŠØ±!", reminder.text);
                    reminder.activated = true;
                    saveReminders();
                    updateUI();
                }

                // ÙØ­Øµ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ù…Ø¨Ù†ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹
                if (reminder.type === 'location' && currentUserLocation && reminder.coords) {
                    const distance = calculateDistance(
                        currentUserLocation.lat,
                        currentUserLocation.lng,
                        reminder.coords.lat,
                        reminder.coords.lng
                    );

                    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø³Ø§ÙØ© Ø£Ù‚Ù„ Ù…Ù† 80 Ù…ØªØ± (0.08 ÙƒÙŠÙ„ÙˆÙ…ØªØ±)
                    console.log(`Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† ${reminder.locationName || 'Ø§Ù„Ù…ÙˆÙ‚Ø¹'}: ${(distance * 1000).toFixed(0)} Ù…ØªØ±`);
                    
                    if (distance < 0.08) { // 80 Ù…ØªØ±
                        const locationName = reminder.locationName || 'Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯';
                        showAlert(`ğŸ“ ÙˆØµÙ„Øª Ø¥Ù„Ù‰ ${locationName}`, reminder.text);
                        reminder.activated = true;
                        saveReminders();
                        updateUI();
                    }
                }
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        function updateUI() {
            const list = document.getElementById('remindersList');
            const count = document.getElementById('reminderCount');
            
            count.textContent = reminders.length;

            if (reminders.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°ÙƒÙŠØ±Ø§Øª Ø¨Ø¹Ø¯</p>
                        <p style="font-size: 13px; margin-top: 5px;">Ø§Ø¶ØºØ· "â• Ø¥Ø¶Ø§ÙØ©" Ù„Ù„Ø¨Ø¯Ø¡</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = reminders.map((r, i) => {
                let countdownText = '';
                let displayInfo = '';
                let soonClass = '';

                if (r.activated) {
                    countdownText = 'âœ… ØªÙ…';
                } else if (r.type === 'time') {
                    const remaining = getTimeRemaining(r.time);
                    const h = remaining.hours;
                    const m = remaining.minutes;
                    const s = remaining.seconds;

                    displayInfo = `â° <span class="time-value">${r.time}</span>`;

                    if (h > 0) {
                        countdownText = `â³ Ø¨Ø§Ù‚ÙŠ ${h}Ø³ ${m}Ø¯`;
                    } else if (m > 0) {
                        countdownText = `â³ Ø¨Ø§Ù‚ÙŠ ${m}Ø¯ ${s}Ø«`;
                    } else {
                        countdownText = `â³ Ø¨Ø§Ù‚ÙŠ ${s}Ø«`;
                    }

                    soonClass = (h === 0 && m < 5) ? 'soon' : '';
                } else if (r.type === 'location') {
                    const locationName = r.locationName || 'Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø¯';
                    displayInfo = `ğŸ“ <span class="time-value">${locationName}</span>`;

                    if (currentUserLocation && r.coords) {
                        const distance = calculateDistance(
                            currentUserLocation.lat,
                            currentUserLocation.lng,
                            r.coords.lat,
                            r.coords.lng
                        );

                        const distKm = distance.toFixed(2);
                        const distM = (distance * 1000).toFixed(0);

                        if (distance < 1) {
                            countdownText = `ğŸ“ ${distM} Ù…ØªØ±`;
                        } else {
                            countdownText = `ğŸ“ ${distKm} ÙƒÙ…`;
                        }

                        soonClass = (distance < 0.5) ? 'soon' : '';
                    } else {
                        countdownText = 'ğŸ“ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹...';
                    }
                }

                return `
                    <div class="reminder-card ${r.activated ? 'active' : ''}" data-index="${i}">
                        <div class="reminder-header">
                            <div class="reminder-text">${r.text}</div>
                            <button class="delete-btn" onclick="deleteReminder(${i})">Ã—</button>
                        </div>
                        <div class="reminder-info">
                            <div class="reminder-time">
                                ${displayInfo}
                            </div>
                            <div class="countdown ${soonClass}">${countdownText}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Ø¥Ø¶Ø§ÙØ© ØªØ°ÙƒÙŠØ±
        function addReminder() {
            const text = document.getElementById('textInput').value.trim();

            if (!text) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ø§Ù„ØªØ°ÙƒÙŠØ±!');
                return;
            }

            const newReminder = {
                text: text,
                type: selectedType,
                activated: false
            };

            if (selectedType === 'time') {
                const time = document.getElementById('timeInput').value;
                if (!time) {
                    alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆÙ‚Øª!');
                    return;
                }
                newReminder.time = time;
            } else {
                const lat = parseFloat(document.getElementById('latInput').value);
                const lng = parseFloat(document.getElementById('lngInput').value);
                
                if (isNaN(lat) || isNaN(lng)) {
                    alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ØµØ­ÙŠØ­Ø©!');
                    return;
                }

                newReminder.coords = { lat, lng };
                newReminder.locationName = document.getElementById('locationNameInput').value.trim() || 'Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø¯';
            }

            reminders.push(newReminder);

            // Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('timeInput').value = '';
            document.getElementById('textInput').value = '';
            document.getElementById('latInput').value = '';
            document.getElementById('lngInput').value = '';
            document.getElementById('locationNameInput').value = '';
            document.getElementById('addForm').classList.remove('show');

            saveReminders();
            updateUI();
            
            showAlert("âœ… ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©", text);
        }

        // Ø­Ø°Ù ØªØ°ÙƒÙŠØ±
        function deleteReminder(index) {
            console.log('Ù…Ø­Ø§ÙˆÙ„Ø© Ø­Ø°Ù Ø§Ù„ØªØ°ÙƒÙŠØ± Ø±Ù‚Ù…:', index);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„ÙÙ‡Ø±Ø³
            if (index < 0 || index >= reminders.length) {
                console.error('ÙÙ‡Ø±Ø³ Ø®Ø§Ø·Ø¦:', index);
                return;
            }
            
            // Ø­Ø°Ù Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† confirm
            const reminderText = reminders[index].text;
            console.log('Ø­Ø°Ù Ø§Ù„ØªØ°ÙƒÙŠØ±:', reminderText);
            
            reminders.splice(index, 1);
            saveReminders();
            updateUI();
            
            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯
            showAlert("ğŸ—‘ï¸ ØªÙ… Ø§Ù„Ø­Ø°Ù", `ØªÙ… Ø­Ø°Ù: ${reminderText}`);
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        function toggleForm() {
            const form = document.getElementById('addForm');
            form.classList.toggle('show');
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        async function startApp() {
            // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
            await requestNotificationPermission();
            
            // ØªØ­Ù…ÙŠÙ„ Ø£ØµÙˆØ§Øª Ø§Ù„Ù†Ø·Ù‚ (Ù…Ù‡Ù… Ù„Ù„Ø¬ÙˆØ§Ù„)
            if ('speechSynthesis' in window) {
                window.speechSynthesis.getVoices();
                window.speechSynthesis.addEventListener('voiceschanged', () => {
                    console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø£ØµÙˆØ§Øª Ø§Ù„Ù†Ø·Ù‚');
                });
            }
            
            // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­
            if (navigator.geolocation) {
                try {
                    // Ø·Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø°Ù†
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            console.log('âœ… ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹');
                            currentUserLocation = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude
                            };
                            
                            // Ø¨Ø¯Ø¡ ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø³ØªÙ…Ø±
                            startLocationTracking();
                        },
                        (error) => {
                            console.log('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹:', error.message);
                            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø´Ø§Ù† ØªØ°ÙƒÙŠØ±Ø§Øª GPS ØªØ´ØªØºÙ„!');
                            
                            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¨Ø¯Ø¡ Ø¹Ù„Ù‰ Ø£ÙŠ Ø­Ø§Ù„
                            startLocationTracking();
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 10000,
                            maximumAge: 0
                        }
                    );
                } catch (e) {
                    console.log('Ø®Ø·Ø£ ÙÙŠ Ø·Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹:', e);
                    startLocationTracking();
                }
            } else {
                console.log('âš ï¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­');
            }
            
            checkInterval = setInterval(checkReminders, 5000); // ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ (Ø£Ø³Ø±Ø¹)
            timeInterval = setInterval(updateCurrentTime, 1000);
            countdownInterval = setInterval(updateCountdowns, 1000);
            
            checkReminders();
            updateCurrentTime();
            updateCountdowns();

            isRunning = true;
            const btn = document.getElementById('startBtn');
            btn.textContent = 'â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù';
            btn.className = 'btn btn-stop';
            document.getElementById('appStatus').textContent = 'â–¶ï¸ ÙŠØ¹Ù…Ù„';
            
            showAlert("âœ… ØªÙ… Ø§Ù„ØªØ´ØºÙŠÙ„", "Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†!");
        }

        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function stopApp() {
            if (checkInterval) clearInterval(checkInterval);
            if (timeInterval) clearInterval(timeInterval);
            if (countdownInterval) clearInterval(countdownInterval);
            
            // Ø¥ÙŠÙ‚Ø§Ù ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹
            stopLocationTracking();

            isRunning = false;
            const btn = document.getElementById('startBtn');
            btn.textContent = 'â–¶ï¸ ØªØ´ØºÙŠÙ„';
            btn.className = 'btn btn-start';
            document.getElementById('appStatus').textContent = 'Ù…ØªÙˆÙ‚Ù';
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©
        function toggleApp() {
            if (isRunning) {
                stopApp();
            } else {
                startApp();
            }
        }

        // Ø­ÙØ¸ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹
        function saveReminders() {
            localStorage.setItem('reminders', JSON.stringify(reminders));
        }

        function loadReminders() {
            const saved = localStorage.getItem('reminders');
            if (saved) {
                reminders = JSON.parse(saved);
            }
        }

        // Ø¹Ø±Ø¶ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªÙ†Ø²ÙŠÙ„
        function showInstallInstructions() {
            document.getElementById('permissionWarning').classList.add('show');
            document.getElementById('installPrompt').classList.remove('show');
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† PWA
        if (window.matchMedia('(display-mode: standalone)').matches) {
            // Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…ÙØªÙˆØ­ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            console.log('Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹Ù…Ù„ ÙƒÙ€ PWA');
        } else {
            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø²ÙŠÙ„
            setTimeout(() => {
                document.getElementById('installPrompt').classList.add('show');
            }, 2000);
        }

        // Ù…Ù†Ø¹ Ø§Ù„Ù†ÙˆÙ…
        let wakeLock = null;
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                }
            } catch (e) {
                console.log('Wake Lock ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…');
            }
        }

        // Ø¹Ù†Ø¯ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø©
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && wakeLock !== null && isRunning) {
                requestWakeLock();
            }
        });

        // ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
        loadReminders();
        updateUI();
        updateCurrentTime();
        requestWakeLock();
    </script>
</body>
</html>
